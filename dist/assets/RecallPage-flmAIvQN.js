import{d as Q,u as Y,a as V,b as Z,e as ee,r as s,s as te,h as se,c as h,j as e,m as g,R as ae,i as H,E as re}from"./index-BxJXOgmm.js";import{R as le}from"./rotate-ccw-K5JJLDV9.js";import{C as ne}from"./circle-check-big-CmTdK0mA.js";import{C as oe}from"./circle-x-CxMrztiM.js";const ie=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],ce=Q("keyboard",ie);const de=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],ue=Q("lightbulb",de),xe="sozyola_tg_lang";function E(p){const n=[...p];for(let i=n.length-1;i>0;i--){const y=Math.floor(Math.random()*(i+1));[n[i],n[y]]=[n[y],n[i]]}return n}const pe=()=>{const p=Y(),{bookId:n,unitId:i}=V(),{saveResult:y,addWordsLearned:_,setLastStudied:W,updateStreak:q}=Z(),u=ee.find(t=>t.id===Number(n)),l=u?.units.find(t=>t.id===Number(i)),[a]=s.useState(()=>localStorage.getItem(xe)||"uz"),[c,M]=s.useState([]),[x,R]=s.useState(0),[b,k]=s.useState(""),[o,v]=s.useState(null),[m,I]=s.useState(0),[L,w]=s.useState(0),[j,C]=s.useState([]),[G,A]=s.useState(!1),[z,B]=s.useState(!1),[K,S]=s.useState(!1),$=s.useRef(null);s.useEffect(()=>{l&&M(E(l.words))},[l]),s.useEffect(()=>{te(()=>p(`/unit/${n}/${i}`)),se(),u&&l&&(W(u.id,l.id),q())},[p,n,i,u,l,W,q]),s.useEffect(()=>{!o&&$.current&&$.current.focus()},[x,o]);const r=c[x],O=s.useCallback(()=>{if(!r)return"";const t=r.word;return t.length<=2?t[0]+"_":t[0]+"_".repeat(t.length-2)+t[t.length-1]},[r]),T=t=>t.toLowerCase().trim().replace(/[^a-z]/g,""),P=s.useCallback(()=>{if(!r||!b.trim())return;const t=T(b),f=T(r.word),d=t===f;v(d?"correct":"wrong"),d?(h.notification("success"),I(N=>N+1)):(h.notification("error"),w(N=>N+1),C(N=>[...N,r]))},[b,r]),X=s.useCallback(()=>{r&&(v("revealed"),w(t=>t+1),C(t=>[...t,r]),h.impact("medium"))},[r]),D=s.useCallback(()=>{if(S(!1),x<c.length-1)R(t=>t+1),k(""),v(null);else{const t=c.length,f=Math.round(m/t*100);u&&l&&!z&&(y(u.id,l.id,{score:m,total:t,percentage:f,date:new Date().toISOString()}),_(m)),A(!0),h.notification(f>=80?"success":"warning")}},[x,c.length,m,u,l,z,y,_]),F=s.useCallback(()=>{const t=E(j);M(t),R(0),k(""),v(null),I(0),w(0),C([]),A(!1),B(!0),S(!1),h.impact("medium")},[j]),J=s.useCallback(()=>{l&&M(E(l.words)),R(0),k(""),v(null),I(0),w(0),C([]),A(!1),B(!1),S(!1),h.impact("medium")},[l]);if(!u||!l||c.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{style:{color:"var(--tg-hint)"},children:"Loading..."})});if(G){const t=c.length,f=t>0?Math.round(m/t*100):0,d=f>=80;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center px-6 pb-6 safe-area-bottom",children:[e.jsx(g.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},className:"w-20 h-20 rounded-full flex items-center justify-center mb-4",style:{background:d?"linear-gradient(135deg, #22c55e, #10b981)":"linear-gradient(135deg, #f59e0b, #f97316)",boxShadow:d?"0 0 30px rgba(34, 197, 94, 0.4)":"0 0 30px rgba(245, 158, 11, 0.4)"},children:e.jsx(ce,{size:36,color:"white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--tg-text)"},children:z?a==="uz"?"Qayta urinish tugadi!":"Retry Complete!":a==="uz"?"So'zni eslab qolish tugadi!":"Word Recall Complete!"}),e.jsxs(g.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2},className:"text-5xl font-extrabold mb-4",style:{color:d?"#22c55e":"#f59e0b"},children:[f,"%"]}),e.jsxs("div",{className:"flex gap-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#22c55e"},children:m}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:a==="uz"?"To'g'ri":"Correct"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#ef4444"},children:L}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:a==="uz"?"Noto'g'ri":"Incorrect"})]})]}),e.jsx("div",{className:"px-4 py-3 rounded-xl mb-6 text-center",style:{backgroundColor:d?"#22c55e20":"#f59e0b20",maxWidth:"280px"},children:e.jsx("p",{className:"text-sm font-medium",style:{color:d?"#22c55e":"#f59e0b"},children:d?a==="uz"?"Ajoyib xotira! Davom eting.":"Great memory! Keep it up.":a==="uz"?"Mashq qilishda davom eting!":"Keep practicing to improve!"})}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-[280px]",children:[j.length>0&&e.jsxs("button",{onClick:F,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:[e.jsx(le,{size:18}),a==="uz"?`Xatolarni mashq qilish (${j.length})`:`Practice Incorrect (${j.length})`]}),e.jsxs("button",{onClick:J,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)"},children:[e.jsx(ae,{size:18}),a==="uz"?"Qaytadan boshlash":"Start Over"]}),e.jsx("button",{onClick:()=>p(`/unit/${n}/${i}`),className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-hint)"},children:a==="uz"?"Bo'limga qaytish":"Back to Unit"})]})]})}const U=(x+1)/c.length*100;return e.jsxs("div",{className:"h-full flex flex-col px-4 pt-2 pb-6 safe-area-bottom",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--tg-hint)"},children:z?a==="uz"?"Qayta urinish":"Retry Mode":`${x+1} / ${c.length}`}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{style:{color:"#22c55e"},children:["✓ ",m]}),e.jsxs("span",{style:{color:"#ef4444"},children:["✗ ",L]})]})]}),e.jsx("div",{className:"h-1.5 rounded-full overflow-hidden",style:{backgroundColor:"var(--tg-secondary-bg)"},children:e.jsx(g.div,{className:"h-full rounded-full",style:{backgroundColor:"var(--tg-button)"},initial:{width:0},animate:{width:`${U}%`},transition:{duration:.3}})})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsx(H,{mode:"wait",children:e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"w-full max-w-sm text-center mb-6",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider mb-3 font-medium",style:{color:"var(--tg-section-header)"},children:a==="uz"?"Inglizcha so'zni yozing:":"Type the English word for:"}),e.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"var(--tg-text)"},children:r?.meaning}),r?.meaningRu&&e.jsxs("p",{className:"text-sm mb-2",style:{color:"var(--tg-subtitle)"},children:["(",r.meaningRu,")"]}),e.jsx("p",{className:"text-sm leading-relaxed",style:{color:"var(--tg-hint)"},children:r?.definition}),K&&e.jsx(g.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"mt-3 px-3 py-2 rounded-lg inline-block",style:{backgroundColor:"#f59e0b20"},children:e.jsx("p",{className:"text-sm font-mono font-bold tracking-widest",style:{color:"#f59e0b"},children:O()})})]},x)}),e.jsxs("div",{className:"w-full max-w-sm",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{ref:$,type:"text",value:b,onChange:t=>k(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(o?D():P())},disabled:o!==null,placeholder:a==="uz"?"So'zni yozing...":"Type the word...",className:"w-full px-4 py-3.5 rounded-xl text-center text-lg font-medium outline-none",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)",border:`2px solid ${o==="correct"?"#22c55e":o==="wrong"||o==="revealed"?"#ef4444":"transparent"}`},autoComplete:"off",autoCapitalize:"off",spellCheck:!1})}),e.jsx(H,{children:o&&e.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-3 text-center",children:o==="correct"?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-500",children:[e.jsx(ne,{size:18}),e.jsx("span",{className:"text-sm font-semibold",children:a==="uz"?"To'g'ri!":"Correct!"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-500 mb-1",children:[e.jsx(oe,{size:18}),e.jsx("span",{className:"text-sm font-semibold",children:o==="revealed"?a==="uz"?"Javob ko'rsatildi":"Answer revealed":a==="uz"?"Noto'g'ri":"Incorrect"})]}),e.jsxs("p",{className:"text-sm font-bold",style:{color:"var(--tg-text)"},children:[a==="uz"?"To'g'ri javob: ":"Correct answer: ",e.jsx("span",{className:"text-green-500",children:r?.word})]})]})})})]})]}),e.jsx("div",{className:"flex gap-3 mt-4",children:o===null?e.jsxs(e.Fragment,{children:[K?e.jsx("button",{onClick:X,className:"flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-semibold active:scale-[0.98] transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-subtitle)"},children:e.jsx(re,{size:16})}):e.jsx("button",{onClick:()=>S(!0),className:"flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-semibold active:scale-[0.98] transition-transform",style:{backgroundColor:"#f59e0b20",color:"#f59e0b"},children:e.jsx(ue,{size:16})}),e.jsx("button",{onClick:P,disabled:!b.trim(),className:"flex-1 py-3 rounded-xl text-sm font-semibold active:scale-[0.98] transition-transform disabled:opacity-40",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:a==="uz"?"Tekshirish":"Check"})]}):e.jsx("button",{onClick:D,className:"w-full py-3.5 rounded-xl text-sm font-semibold active:scale-[0.98] transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:x<c.length-1?a==="uz"?"Keyingi so'z →":"Next Word →":a==="uz"?"Natijalarni ko'rish":"See Results"})})]})};export{pe as RecallPage};
