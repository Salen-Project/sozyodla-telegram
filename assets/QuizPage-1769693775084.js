import{j as e,m as B,k as D,X as T,u as q,a as L,b as G,e as K,r as a,s as X,h as F,c as R,T as H,A as J,P as U}from"./index-1769693775084.js";import{R as O}from"./rotate-ccw-1769693775084.js";const V=({text:c,index:n,isSelected:t,isCorrect:o,disabled:d,onSelect:f})=>{const v=["A","B","C","D"],i=()=>o===!0?"#22c55e":o===!1&&t?"#ef4444":t?"var(--tg-button)":"var(--tg-secondary-bg)",u=()=>o===!0?"#22c55e15":o===!1&&t?"#ef444415":"var(--tg-section-bg)";return e.jsxs(B.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0,x:o===!1&&t?[0,-10,10,-8,8,-4,4,0]:0,scale:o===!0?[1,1.02,1]:1},transition:{delay:o!==null?0:n*.08,x:{duration:.4},scale:{duration:.3}},whileTap:d?void 0:{scale:.97},onClick:f,disabled:d,className:"w-full flex items-center gap-3 p-4 rounded-xl border-2 text-left transition-colors",style:{borderColor:i(),backgroundColor:u(),opacity:d&&!t&&o!==!0?.5:1},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shrink-0",style:{backgroundColor:t?"var(--tg-button)":"var(--tg-secondary-bg)",color:t?"var(--tg-button-text)":"var(--tg-text)"},children:o===!0?e.jsx(D,{size:16}):o===!1&&t?e.jsx(T,{size:16}):v[n]}),e.jsx("span",{className:"text-sm font-medium flex-1",style:{color:"var(--tg-text)"},children:c})]})};function z(c){const n=[...c];for(let t=n.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[n[t],n[o]]=[n[o],n[t]]}return n}function P(c){return z(c).map(n=>{const t=c.filter(f=>f.word!==n.word),o=z(t).slice(0,3).map(f=>f.meaning),d=z([...o,n.meaning]);return{word:n,options:d,correctIndex:d.indexOf(n.meaning)}})}const _=()=>{const c=q(),{bookId:n,unitId:t}=L(),{saveResult:o,addWordsLearned:d,setLastStudied:f,updateStreak:v}=G(),i=K.find(l=>l.id===Number(n)),u=i?.units.find(l=>l.id===Number(t)),S=u?.words||[],r=a.useMemo(()=>P(S),[S]),[x,w]=a.useState(0),[m,b]=a.useState(null),[A,y]=a.useState(null),[h,N]=a.useState(0),[M,k]=a.useState(!1),[C,I]=a.useState([]);a.useEffect(()=>{X(()=>c(`/unit/${n}/${t}`)),F(),i&&u&&(f(i.id,u.id),v())},[c,n,t,i,u,f,v]);const Q=a.useCallback(l=>{if(m!==null)return;b(l);const s=l===r[x].correctIndex;y(s),I(g=>[...g,{correct:s,word:r[x].word}]),s?(R.notification("success"),N(g=>g+1)):R.notification("error")},[m,x,r]),$=a.useCallback(()=>{if(x<r.length-1)w(l=>l+1),b(null),y(null);else{const l=r.length,s=Math.round(h/l*100);i&&u&&(o(i.id,u.id,{score:h,total:l,percentage:s,date:new Date().toISOString()}),d(h)),k(!0),R.notification("success")}},[x,r.length,h,A,i,u,o,d]);if(!i||!u||S.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{style:{color:"var(--tg-hint)"},children:"No words found"})});const W=a.useCallback(()=>{const l=C.filter(s=>!s.correct).map(s=>s.word);l.length>0&&(P(l),w(0),b(null),y(null),N(0),k(!1),I([])),w(0),b(null),y(null),N(0),k(!1),I([])},[C]);if(M){const l=Math.round(h/r.length*100),s=l>=80,g=C.filter(p=>!p.correct).length;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center px-6 pb-6 overflow-y-auto",children:[e.jsx(B.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},className:"mb-4",children:e.jsx(H,{size:56,className:s?"text-yellow-500":"text-gray-400"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--tg-text)"},children:s?"Excellent! ðŸŽ‰":"Keep Practicing! ðŸ’ª"}),e.jsxs("div",{className:"text-4xl font-bold mb-2",style:{color:s?"#22c55e":"#f59e0b"},children:[l,"%"]}),e.jsxs("p",{className:"text-sm mb-4",style:{color:"var(--tg-subtitle)"},children:[h," out of ",r.length," correct"]}),g>0&&e.jsxs("div",{className:"w-full max-w-[300px] mb-4 max-h-32 overflow-y-auto",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider mb-2 font-semibold",style:{color:"var(--tg-section-header)"},children:"Words to Review"}),C.filter(p=>!p.correct).map((p,E)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg mb-1",style:{backgroundColor:"#ef444415"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--tg-text)"},children:p.word.word}),e.jsxs("span",{className:"text-xs",style:{color:"var(--tg-hint)"},children:["â€” ",p.word.meaning]})]},E))]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full max-w-[280px]",children:[g>0&&e.jsxs("button",{onClick:W,className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl text-sm font-semibold",style:{backgroundColor:"#f59e0b",color:"white"},children:[e.jsx(O,{size:16})," Retry Incorrect (",g,")"]}),e.jsxs("button",{onClick:()=>{w(0),b(null),y(null),N(0),k(!1),I([])},className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl text-sm font-semibold",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)"},children:[e.jsx(O,{size:16})," Retry All"]}),e.jsxs("button",{onClick:()=>c(`/unit/${n}/${t}`),className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl text-sm font-semibold",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:["Done ",e.jsx(J,{size:16})]})]})]})}const j=r[x];return e.jsxs("div",{className:"h-full flex flex-col px-4 pt-4 pb-6 safe-area-bottom",children:[e.jsx("div",{className:"mb-4",children:e.jsx(U,{current:x+1,total:r.length,label:"Progress"})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider mb-2 font-medium",style:{color:"var(--tg-section-header)"},children:"What does this word mean?"}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--tg-text)"},children:j.word.word}),j.word.partOfSpeech&&e.jsxs("span",{className:"text-xs mt-1 inline-block",style:{color:"var(--tg-hint)"},children:["(",j.word.partOfSpeech,")"]})]}),e.jsx("div",{className:"space-y-2 flex-1",children:j.options.map((l,s)=>e.jsx(V,{text:l,index:s,isSelected:m===s,isCorrect:m!==null?s===j.correctIndex?!0:m===s?!1:null:null,disabled:m!==null,onSelect:()=>Q(s)},`${x}-${s}`))}),m!==null&&e.jsx(B.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},onClick:$,className:"w-full py-3.5 rounded-xl text-sm font-semibold mt-4 active:scale-[0.98] transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:x<r.length-1?"Next Question â†’":"See Results"})]})]})};export{_ as QuizPage};
