import{u as ne,a as oe,b as le,r as o,e as ae,s as re,h as ce,j as e,m as y,R as ie,i as U,c as z}from"./index-BZO-etuH.js";import{F as de}from"./file-text-DRh4O7wH.js";import{R as ue}from"./rotate-ccw-DfzYLX8j.js";const xe="sozyola_tg_lang",fe=10;function B(m){const l=[...m];for(let a=l.length-1;a>0;a--){const d=Math.floor(Math.random()*(a+1));[l[a],l[d]]=[l[d],l[a]]}return l}function me(m,l){const a=new RegExp(`\\b${m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i"),d=l.match(a);return!d||d.index===void 0?null:{before:l.slice(0,d.index),after:l.slice(d.index+d[0].length)}}const pe=()=>{const m=ne(),{bookId:l,unitId:a}=oe(),{saveResult:d,addWordsLearned:q,setLastStudied:$,updateStreak:I}=le(),[r]=o.useState(()=>localStorage.getItem(xe)||"uz"),h=ae.find(t=>t.id===Number(l)),g=h?.units.find(t=>t.id===Number(a)),v=g?.words||[],[x,K]=o.useState([]),[_,E]=o.useState([]),[f,L]=o.useState(0),[D,k]=o.useState(null),[u,C]=o.useState(null),[b,W]=o.useState(!1),[j,O]=o.useState(!1),[Q,F]=o.useState(0),[X,M]=o.useState(0),[Y,A]=o.useState(!1),[N,P]=o.useState([]),[T,Z]=o.useState([]),w=o.useCallback(t=>{const n=t||v,s=[],c=[],S=B(n);for(const i of S){if(s.length>=fe)break;const R=me(i.word,i.example);R&&(s.push({word:i.word.toLowerCase(),sentence:i.example,beforeBlank:R.before,afterBlank:R.after}),c.push(i))}K(s),Z(c);const G=s.map(i=>i.word),se=B(v.filter(i=>!G.includes(i.word.toLowerCase()))).slice(0,3).map(i=>i.word.toLowerCase());E(B([...G.slice(0,4),...se])),L(0),k(null),C(null),W(!1),F(0),M(0),A(!1),P([])},[v]),H=o.useCallback(()=>{const t=T.filter((n,s)=>!N[s]);t.length>0&&w(t)},[T,N,w]);o.useEffect(()=>{v.length>0&&w()},[v,w]),o.useEffect(()=>{re(()=>m(`/unit/${l}/${a}`)),ce(),h&&g&&($(h.id,g.id),I())},[m,l,a,h,g,$,I]);const p=x[f],J=t=>{b||(u===t?(C(null),k(null)):u===null&&(C(t),k(t)),z.impact("light"))},V=()=>{if(!u||!p)return;const t=u===p.word;O(t),W(!0),t?(z.notification("success"),F(n=>n+1)):(z.notification("error"),M(n=>n+1))},ee=()=>{const t=[...N,j];P(t),W(!1),C(null),k(null);const n=_.filter(s=>s!==p.word);if(f+1<x.length&&x[f+1]){const s=x[f+1].word;n.includes(s)||n.push(s)}if(E(B(n)),f+1<x.length)L(s=>s+1);else{const s=t.filter(Boolean).length,c=t.length,S=Math.round(s/c*100);h&&g&&(d(h.id,g.id,{score:s,total:c,percentage:S,date:new Date().toISOString()}),q(s)),A(!0),z.notification(S>=80?"success":"warning")}};if(!h||!g||x.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{style:{color:"var(--tg-hint)"},children:"Loading..."})});if(Y){const t=N.filter(Boolean).length,n=N.length,s=Math.round(t/n*100),c=s>=80;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center px-6 pb-6 safe-area-bottom",children:[e.jsx(y.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},className:"w-20 h-20 rounded-full flex items-center justify-center mb-4",style:{background:c?"linear-gradient(135deg, #22c55e, #10b981)":"linear-gradient(135deg, #f59e0b, #f97316)"},children:e.jsx(de,{size:36,color:"white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--tg-text)"},children:r==="uz"?"Bo'sh joyni to'ldirish tugadi!":"Fill in Blank Complete!"}),e.jsxs(y.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2},className:"text-5xl font-extrabold mb-4",style:{color:c?"#22c55e":"#f59e0b"},children:[s,"%"]}),e.jsxs("div",{className:"flex gap-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#22c55e"},children:t}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:r==="uz"?"To'g'ri":"Correct"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#ef4444"},children:n-t}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:r==="uz"?"Noto'g'ri":"Incorrect"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-[280px]",children:[n-t>0&&e.jsxs("button",{onClick:H,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"#f59e0b",color:"white"},children:[e.jsx(ue,{size:18}),r==="uz"?`Xato so'zlarni qaytadan (${n-t})`:`Retry Incorrect (${n-t})`]}),e.jsxs("button",{onClick:()=>w(),className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:[e.jsx(ie,{size:18}),r==="uz"?"Qayta o'ynash":"Play Again"]}),e.jsx("button",{onClick:()=>m(`/unit/${l}/${a}`),className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)"},children:r==="uz"?"Bo'limga qaytish":"Back to Unit"})]})]})}const te=(f+1)/x.length*100;return e.jsxs("div",{className:"h-full flex flex-col px-4 pt-2 pb-6 safe-area-bottom",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs font-medium",style:{color:"var(--tg-hint)"},children:[f+1," / ",x.length]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{style:{color:"#22c55e"},children:["✓ ",Q]}),e.jsxs("span",{style:{color:"#ef4444"},children:["✗ ",X]})]})]}),e.jsx("div",{className:"h-1.5 rounded-full overflow-hidden",style:{backgroundColor:"var(--tg-secondary-bg)"},children:e.jsx(y.div,{className:"h-full rounded-full",style:{backgroundColor:"var(--tg-button)"},animate:{width:`${te}%`},transition:{duration:.3}})})]}),e.jsx("p",{className:"text-xs uppercase tracking-wider mb-3 font-medium text-center",style:{color:"var(--tg-section-header)"},children:r==="uz"?"Bo'sh joyni to'ldiring":"Fill in the blank"}),e.jsx(U,{mode:"wait",children:e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"p-4 rounded-xl mb-4",style:{backgroundColor:"var(--tg-section-bg)"},children:e.jsxs("p",{className:"text-base leading-relaxed",style:{color:"var(--tg-text)"},children:[p.beforeBlank,e.jsx("span",{className:"inline-block mx-1 px-3 py-1 rounded-lg min-w-[80px] text-center font-semibold",style:{backgroundColor:b?j?"#22c55e20":"#ef444420":u?"var(--tg-button)":"var(--tg-secondary-bg)",color:b?j?"#22c55e":"#ef4444":u?"var(--tg-button-text)":"var(--tg-hint)",border:`2px dashed ${b?j?"#22c55e":"#ef4444":u?"var(--tg-button)":"var(--tg-hint)"}`},children:u||"______"}),p.afterBlank]})},f)}),e.jsx(U,{children:b&&!j&&e.jsxs(y.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},className:"text-center mb-4",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--tg-hint)"},children:r==="uz"?"To'g'ri javob:":"Correct answer:"}),e.jsx("p",{className:"text-lg font-bold text-green-500",children:p.word})]})}),!b&&e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs mb-2 font-medium",style:{color:"var(--tg-hint)"},children:r==="uz"?"So'zlardan birini tanlang:":"Choose a word:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map((t,n)=>{const s=D===t,c=u===t;return e.jsx(y.button,{onClick:()=>J(t),className:"px-4 py-2 rounded-xl text-sm font-medium transition-all",style:{backgroundColor:s||c?"var(--tg-button)":"var(--tg-section-bg)",color:s||c?"var(--tg-button-text)":"var(--tg-text)",opacity:c&&!s?.4:1},whileTap:{scale:.95},children:t},`${t}-${n}`)})})]}),e.jsx("div",{className:"mt-auto pt-4",children:b?e.jsx("button",{onClick:ee,className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:f<x.length-1?r==="uz"?"Keyingi →":"Next →":r==="uz"?"Natijalarni ko'rish":"See Results"}):e.jsx("button",{onClick:V,disabled:!u,className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform disabled:opacity-40",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:r==="uz"?"Tekshirish":"Check"})})]})};export{pe as FillBlankPage};
