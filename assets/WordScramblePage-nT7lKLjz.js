import{u as Y,a as Z,b as J,r,e as V,s as ee,h as te,j as e,m as j,i as se,X as le,R as ne,c as C}from"./index-IKJjTM0H.js";import{S as re}from"./shuffle-CWU1Tvn5.js";import{R as L}from"./rotate-ccw-Ds_stX6s.js";import{A as oe}from"./index-BfuhdmPI.js";const ae="sozyola_tg_lang",ce=10;function T(x){const n=[...x];for(let o=n.length-1;o>0;o--){const g=Math.floor(Math.random()*(o+1));[n[o],n[g]]=[n[g],n[o]]}return n}function ie(x){const n=x.toUpperCase().split("");for(let o=0;o<20;o++){const g=T(n);if(g.join("")!==n.join(""))return g}return[...n].reverse()}const ge=()=>{const x=Y(),{bookId:n,unitId:o}=Z(),{saveResult:g,addWordsLearned:P,setLastStudied:I,updateStreak:R}=J(),[a]=r.useState(()=>localStorage.getItem(ae)||"uz"),h=V.find(t=>t.id===Number(n)),b=h?.units.find(t=>t.id===Number(o)),p=b?.words||[],A=r.useCallback(t=>a==="ru"&&t.meaningRu?t.meaningRu:t.meaning,[a]),[c,U]=r.useState([]),[y,W]=r.useState(0),[i,w]=r.useState([]),[d,S]=r.useState(!1),[N,$]=r.useState(!1),[u,B]=r.useState([]),[_,E]=r.useState(!1),[de,q]=r.useState([]),k=r.useCallback(t=>{const s=t||p,f=T(s).slice(0,Math.min(ce,s.length)).map(v=>({word:v.word.toUpperCase(),clue:A(v),scrambled:ie(v.word),originalWord:v}));U(f),W(0),w(new Array(f[0]?.word.length||0).fill(null)),S(!1),$(!1),B([]),E(!1),t||q([])},[p,A]),G=r.useCallback(()=>{const t=c.filter((s,l)=>!u[l]).map(s=>p.find(l=>l.word.toUpperCase()===s.word)).filter(s=>s!==void 0);t.length>0&&k(t)},[c,u,p,k]);r.useEffect(()=>{p.length>0&&k()},[p]),r.useEffect(()=>{ee(()=>x(`/unit/${n}/${o}`)),te(),h&&b&&(I(h.id,b.id),R())},[x,n,o,h,b,I,R]);const m=c[y],M=new Set(i.filter(t=>t!==null)),F=t=>{if(d||M.has(t))return;const s=i.indexOf(null);if(s===-1)return;const l=[...i];l[s]=t,w(l),C.impact("light")},K=t=>{if(d||i[t]===null)return;const s=[...i];s[t]=null,w(s),C.impact("light")},O=()=>{if(!m)return;const s=i.map(l=>l!==null?m.scrambled[l]:"").join("")===m.word;$(s),S(!0),C.notification(s?"success":"error")},X=()=>{const t=[...u,N];if(B(t),S(!1),y+1<c.length){const s=y+1;W(s),w(new Array(c[s].word.length).fill(null))}else{const s=t.filter(Boolean).length,l=t.length,f=Math.round(s/l*100);h&&b&&(g(h.id,b.id,{score:s,total:l,percentage:f,date:new Date().toISOString()}),P(s)),E(!0),C.notification(f>=80?"success":"warning")}},D=()=>{w(new Array(m?.word.length||0).fill(null)),C.impact("medium")};if(!h||!b||c.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{style:{color:"var(--tg-hint)"},children:"Loading..."})});if(_){const t=u.filter(Boolean).length,s=u.length,l=Math.round(t/s*100),f=l>=80;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center px-6 pb-6 safe-area-bottom",children:[e.jsx(j.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},className:"w-20 h-20 rounded-full flex items-center justify-center mb-4",style:{background:f?"linear-gradient(135deg, #22c55e, #10b981)":"linear-gradient(135deg, #f59e0b, #f97316)"},children:e.jsx(re,{size:36,color:"white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--tg-text)"},children:a==="uz"?"So'z jumboq tugadi!":"Word Scramble Complete!"}),e.jsxs(j.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2},className:"text-5xl font-extrabold mb-4",style:{color:f?"#22c55e":"#f59e0b"},children:[l,"%"]}),e.jsxs("div",{className:"flex gap-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#22c55e"},children:t}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:a==="uz"?"To'g'ri":"Correct"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#ef4444"},children:s-t}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:a==="uz"?"Noto'g'ri":"Incorrect"})]})]}),e.jsx("div",{className:"w-full max-w-[300px] mb-6 max-h-40 overflow-y-auto",children:c.map((v,z)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg mb-1",style:{backgroundColor:u[z]?"#22c55e15":"#ef444415"},children:[u[z]?e.jsx(se,{size:14,style:{color:"#22c55e"}}):e.jsx(le,{size:14,style:{color:"#ef4444"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--tg-text)"},children:v.word})]},z))}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-[280px]",children:[s-t>0&&e.jsxs("button",{onClick:G,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"#f59e0b",color:"white"},children:[e.jsx(L,{size:18}),a==="uz"?`Xato so'zlarni qaytadan (${s-t})`:`Retry Incorrect (${s-t})`]}),e.jsxs("button",{onClick:()=>k(),className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:[e.jsx(ne,{size:18}),a==="uz"?"Qayta o'ynash":"Play Again"]}),e.jsx("button",{onClick:()=>x(`/unit/${n}/${o}`),className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)"},children:a==="uz"?"Bo'limga qaytish":"Back to Unit"})]})]})}const H=i.every(t=>t!==null),Q=(y+1)/c.length*100;return e.jsxs("div",{className:"h-full flex flex-col px-4 pt-2 pb-6 safe-area-bottom",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs font-medium",style:{color:"var(--tg-hint)"},children:[y+1," / ",c.length]}),e.jsxs("span",{className:"text-xs",style:{color:"#22c55e"},children:["✓ ",u.filter(Boolean).length]})]}),e.jsx("div",{className:"h-1.5 rounded-full overflow-hidden",style:{backgroundColor:"var(--tg-secondary-bg)"},children:e.jsx(j.div,{className:"h-full rounded-full",style:{backgroundColor:"var(--tg-button)"},animate:{width:`${Q}%`},transition:{duration:.3}})})]}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider mb-2 font-medium",style:{color:"var(--tg-section-header)"},children:a==="uz"?"Harflarni to'g'ri joylashtiring":"Unscramble the word"}),e.jsx("p",{className:"text-lg font-semibold",style:{color:"var(--tg-text)"},children:m.clue})]}),e.jsx("div",{className:"flex justify-center gap-1.5 mb-6 flex-wrap",children:i.map((t,s)=>e.jsx(j.button,{onClick:()=>K(s),className:"w-10 h-12 rounded-lg flex items-center justify-center text-lg font-bold",style:{backgroundColor:d?N?"#22c55e20":"#ef444420":t!==null?"var(--tg-button)":"var(--tg-secondary-bg)",color:d?N?"#22c55e":"#ef4444":t!==null?"var(--tg-button-text)":"var(--tg-hint)",border:`2px solid ${d?N?"#22c55e":"#ef4444":t!==null?"var(--tg-button)":"var(--tg-secondary-bg)"}`},whileTap:{scale:.95},children:t!==null?m.scrambled[t]:""},`slot-${s}`))}),e.jsx(oe,{children:d&&!N&&e.jsxs(j.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},className:"text-center mb-4",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--tg-hint)"},children:a==="uz"?"To'g'ri javob:":"Correct answer:"}),e.jsx("p",{className:"text-lg font-bold text-green-500",children:m.word})]})}),!d&&e.jsx("div",{className:"flex justify-center gap-2 mb-6 flex-wrap",children:m.scrambled.map((t,s)=>{const l=M.has(s);return e.jsx(j.button,{onClick:()=>F(s),disabled:l,className:"w-10 h-12 rounded-lg flex items-center justify-center text-lg font-bold transition-all",style:{backgroundColor:l?"var(--tg-secondary-bg)":"var(--tg-section-bg)",color:l?"var(--tg-hint)":"var(--tg-text)",opacity:l?.4:1,border:"1px solid var(--tg-secondary-bg)"},whileTap:{scale:l?1:.95},children:t},`letter-${s}`)})}),e.jsx("div",{className:"mt-auto flex gap-3",children:d?e.jsx("button",{onClick:X,className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:y<c.length-1?a==="uz"?"Keyingi so'z →":"Next Word →":a==="uz"?"Natijalarni ko'rish":"See Results"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:D,className:"py-3 px-4 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-subtitle)"},children:e.jsx(L,{size:18})}),e.jsx("button",{onClick:O,disabled:!H,className:"flex-1 py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform disabled:opacity-40",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:a==="uz"?"Tekshirish":"Check"})]})})]})};export{ge as WordScramblePage};
