import{u as te,a as se,b as ae,r as s,e as le,s as ne,h as oe,c as S,j as e,m as k,T as re,Z as K,k as O,R as ce}from"./index-Dbv-jb_x.js";function b(v){const i=[...v];for(let d=i.length-1;d>0;d--){const p=Math.floor(Math.random()*(d+1));[i[d],i[p]]=[i[p],i[d]]}return i}const ie="sozyola_tg_lang",Q=8,ue=()=>{const v=te(),{bookId:i,unitId:d}=se(),{saveResult:p,addWordsLearned:W,setLastStudied:P,updateStreak:E}=ae(),[r]=s.useState(()=>localStorage.getItem(ie)||"uz"),u=le.find(t=>t.id===Number(i)),f=u?.units.find(t=>t.id===Number(d)),h=f?.words||[],c=s.useMemo(()=>b(h).slice(0,Math.min(Q,h.length)),[h]),[g,T]=s.useState([]),[j,A]=s.useState([]),[M,y]=s.useState(null),[z,N]=s.useState(null),[x,B]=s.useState(new Set),[w,G]=s.useState(null),[C,R]=s.useState(!1),[m,D]=s.useState(0),[I,L]=s.useState(Date.now()),[_,J]=s.useState(0);s.useEffect(()=>{c.length>0&&(T(b([...c])),A(b([...c])),L(Date.now()))},[c]),s.useEffect(()=>{if(!C&&g.length>0){const t=setInterval(()=>{J(Math.floor((Date.now()-I)/1e3))},1e3);return()=>clearInterval(t)}},[C,I,g.length]),s.useEffect(()=>{ne(()=>v(`/unit/${i}/${d}`)),oe(),u&&f&&(P(u.id,f.id),E())},[v,i,d,u,f,P,E]);const Z=t=>{const a=Math.floor(t/60),l=t%60;return`${a}:${l.toString().padStart(2,"0")}`},q=s.useCallback((t,a)=>{const l=g[t],o=j[a];if(l.word===o.word){S.notification("success");const n=new Set(x);if(n.add(l.word),B(n),y(null),N(null),n.size===c.length){R(!0),S.notification("success");const $=c.length,H=Math.max(0,$-Math.floor(m/2)),ee=Math.round(H/$*100);u&&f&&(p(u.id,f.id,{score:H,total:$,percentage:ee,date:new Date().toISOString()}),W(c.length))}}else S.notification("error"),D(n=>n+1),G(`${t}-${a}`),setTimeout(()=>{G(null),y(null),N(null)},600)},[g,j,x,c,u,f,m,p,W]),U=t=>{x.has(g[t].word)||w||(y(t),z!==null&&q(t,z))},V=t=>{x.has(j[t].word)||w||(N(t),M!==null&&q(M,t))},X=s.useCallback(()=>{const t=b(h).slice(0,Math.min(Q,h.length));T(b([...t])),A(b([...t])),B(new Set),y(null),N(null),D(0),R(!1),L(Date.now()),J(0),S.impact("medium")},[h]);if(!u||!f)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{style:{color:"var(--tg-hint)"},children:"Loading..."})});if(C){const t=c.length,a=Math.max(0,t-Math.floor(m/2)),l=Math.round(a/t*100),o=m===0,n=l>=80;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center px-6 pb-6 safe-area-bottom",children:[e.jsx(k.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},className:"w-20 h-20 rounded-full flex items-center justify-center mb-4",style:{background:o?"linear-gradient(135deg, #fbbf24, #f59e0b)":n?"linear-gradient(135deg, #22c55e, #10b981)":"linear-gradient(135deg, #3b82f6, #6366f1)",boxShadow:o?"0 0 30px rgba(251, 191, 36, 0.4)":void 0},children:o?e.jsx(re,{size:36,color:"white"}):e.jsx(K,{size:36,color:"white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-1",style:{color:"var(--tg-text)"},children:o?r==="uz"?"Mukammal!":"Perfect!":r==="uz"?"Ajoyib!":"Great Job!"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--tg-subtitle)"},children:r==="uz"?"Barcha juftliklar topildi!":"All pairs matched!"}),e.jsxs("div",{className:"flex gap-6 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(O,{size:16,style:{color:"var(--tg-hint)"}}),e.jsx("span",{className:"text-xl font-bold",style:{color:"var(--tg-text)"},children:Z(_)})]}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:r==="uz"?"Vaqt":"Time"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold",style:{color:m===0?"#22c55e":"#f59e0b"},children:m}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:r==="uz"?"Xatolar":"Mistakes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold",style:{color:"#22c55e"},children:c.length}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:r==="uz"?"Juftliklar":"Pairs"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-[280px]",children:[e.jsxs("button",{onClick:X,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:[e.jsx(ce,{size:18}),r==="uz"?"Qayta o'ynash":"Play Again"]}),e.jsx("button",{onClick:()=>v(`/unit/${i}/${d}`),className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)"},children:r==="uz"?"Bo'limga qaytish":"Back to Unit"})]})]})}const Y=t=>r==="ru"&&t.meaningRu?t.meaningRu:t.meaning,F=x.size/c.length*100;return e.jsxs("div",{className:"h-full flex flex-col px-4 pt-2 pb-4 safe-area-bottom",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{size:18,style:{color:"var(--tg-button)"}}),e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--tg-text)"},children:r==="uz"?"Juftliklarni top":"Match the Pairs"})]}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg",style:{backgroundColor:"var(--tg-secondary-bg)"},children:[e.jsx(O,{size:14,style:{color:"var(--tg-hint)"}}),e.jsx("span",{className:"text-sm font-mono font-medium",style:{color:"var(--tg-text)"},children:Z(_)})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("span",{className:"text-xs",style:{color:"var(--tg-hint)"},children:[x.size,"/",c.length," ",r==="uz"?"topildi":"matched"]}),e.jsxs("span",{className:"text-xs",style:{color:m>0?"#f59e0b":"var(--tg-hint)"},children:[m," ",r==="uz"?"xato":"mistakes"]})]}),e.jsx("div",{className:"h-1.5 rounded-full overflow-hidden",style:{backgroundColor:"var(--tg-secondary-bg)"},children:e.jsx(k.div,{className:"h-full rounded-full",style:{backgroundColor:"var(--tg-button)"},animate:{width:`${F}%`},transition:{duration:.3}})})]}),e.jsxs("div",{className:"flex-1 flex gap-2 overflow-hidden",children:[e.jsx("div",{className:"flex-1 flex flex-col gap-1.5 overflow-y-auto",children:g.map((t,a)=>{const l=x.has(t.word),o=M===a,n=w?.startsWith(`${a}-`);return e.jsx(k.button,{animate:{scale:n?[1,.95,1]:1,opacity:l?.4:1},onClick:()=>U(a),disabled:l,className:"w-full py-2.5 px-2 rounded-xl text-sm font-semibold text-center transition-all",style:{backgroundColor:l?"#22c55e20":o?"var(--tg-button)":n?"#ef444420":"var(--tg-section-bg)",color:l?"#22c55e":o?"var(--tg-button-text)":n?"#ef4444":"var(--tg-text)",border:`1px solid ${o?"var(--tg-button)":"var(--tg-secondary-bg)"}`,minHeight:"44px"},children:t.word},`w-${a}`)})}),e.jsx("div",{className:"flex-1 flex flex-col gap-1.5 overflow-y-auto",children:j.map((t,a)=>{const l=x.has(t.word),o=z===a,n=w?.endsWith(`-${a}`);return e.jsx(k.button,{animate:{scale:n?[1,.95,1]:1,opacity:l?.4:1},onClick:()=>V(a),disabled:l,className:"w-full py-2.5 px-2 rounded-xl text-xs text-center transition-all leading-tight",style:{backgroundColor:l?"#22c55e20":o?"var(--tg-button)":n?"#ef444420":"var(--tg-section-bg)",color:l?"#22c55e":o?"var(--tg-button-text)":n?"#ef4444":"var(--tg-text)",border:`1px solid ${o?"var(--tg-button)":"var(--tg-secondary-bg)"}`,minHeight:"44px"},children:Y(t)},`m-${a}`)})})]})]})};export{ue as MatchingPage};
