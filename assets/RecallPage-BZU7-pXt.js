import{d as E,u as Y,a as V,b as Z,e as ee,r as s,s as te,h as se,c as h,j as e,m as g,R as ae}from"./index-IKJjTM0H.js";import{R as re}from"./rotate-ccw-Ds_stX6s.js";import{A as Q}from"./index-BfuhdmPI.js";import{C as ne}from"./circle-check-big-D4nbqB0j.js";import{C as le}from"./circle-x-7_GgQPLi.js";const oe=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ie=E("eye",oe);const ce=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],de=E("keyboard",ce);const ue=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],me=E("lightbulb",ue),xe="sozyola_tg_lang";function _(p){const l=[...p];for(let i=l.length-1;i>0;i--){const y=Math.floor(Math.random()*(i+1));[l[i],l[y]]=[l[y],l[i]]}return l}const be=()=>{const p=Y(),{bookId:l,unitId:i}=V(),{saveResult:y,addWordsLearned:W,setLastStudied:q,updateStreak:L}=Z(),u=ee.find(t=>t.id===Number(l)),n=u?.units.find(t=>t.id===Number(i)),[a]=s.useState(()=>localStorage.getItem(xe)||"uz"),[c,M]=s.useState([]),[m,R]=s.useState(0),[b,k]=s.useState(""),[o,v]=s.useState(null),[x,I]=s.useState(0),[B,w]=s.useState(0),[j,C]=s.useState([]),[G,A]=s.useState(!1),[z,K]=s.useState(!1),[T,S]=s.useState(!1),$=s.useRef(null);s.useEffect(()=>{n&&M(_(n.words))},[n]),s.useEffect(()=>{te(()=>p(`/unit/${l}/${i}`)),se(),u&&n&&(q(u.id,n.id),L())},[p,l,i,u,n,q,L]),s.useEffect(()=>{!o&&$.current&&$.current.focus()},[m,o]);const r=c[m],O=s.useCallback(()=>{if(!r)return"";const t=r.word;return t.length<=2?t[0]+"_":t[0]+"_".repeat(t.length-2)+t[t.length-1]},[r]),P=t=>t.toLowerCase().trim().replace(/[^a-z]/g,""),D=s.useCallback(()=>{if(!r||!b.trim())return;const t=P(b),f=P(r.word),d=t===f;v(d?"correct":"wrong"),d?(h.notification("success"),I(N=>N+1)):(h.notification("error"),w(N=>N+1),C(N=>[...N,r]))},[b,r]),X=s.useCallback(()=>{r&&(v("revealed"),w(t=>t+1),C(t=>[...t,r]),h.impact("medium"))},[r]),H=s.useCallback(()=>{if(S(!1),m<c.length-1)R(t=>t+1),k(""),v(null);else{const t=c.length,f=Math.round(x/t*100);u&&n&&!z&&(y(u.id,n.id,{score:x,total:t,percentage:f,date:new Date().toISOString()}),W(x)),A(!0),h.notification(f>=80?"success":"warning")}},[m,c.length,x,u,n,z,y,W]),F=s.useCallback(()=>{const t=_(j);M(t),R(0),k(""),v(null),I(0),w(0),C([]),A(!1),K(!0),S(!1),h.impact("medium")},[j]),J=s.useCallback(()=>{n&&M(_(n.words)),R(0),k(""),v(null),I(0),w(0),C([]),A(!1),K(!1),S(!1),h.impact("medium")},[n]);if(!u||!n||c.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{style:{color:"var(--tg-hint)"},children:"Loading..."})});if(G){const t=c.length,f=t>0?Math.round(x/t*100):0,d=f>=80;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center px-6 pb-6 safe-area-bottom",children:[e.jsx(g.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},className:"w-20 h-20 rounded-full flex items-center justify-center mb-4",style:{background:d?"linear-gradient(135deg, #22c55e, #10b981)":"linear-gradient(135deg, #f59e0b, #f97316)",boxShadow:d?"0 0 30px rgba(34, 197, 94, 0.4)":"0 0 30px rgba(245, 158, 11, 0.4)"},children:e.jsx(de,{size:36,color:"white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--tg-text)"},children:z?a==="uz"?"Qayta urinish tugadi!":"Retry Complete!":a==="uz"?"So'zni eslab qolish tugadi!":"Word Recall Complete!"}),e.jsxs(g.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2},className:"text-5xl font-extrabold mb-4",style:{color:d?"#22c55e":"#f59e0b"},children:[f,"%"]}),e.jsxs("div",{className:"flex gap-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#22c55e"},children:x}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:a==="uz"?"To'g'ri":"Correct"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#ef4444"},children:B}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:a==="uz"?"Noto'g'ri":"Incorrect"})]})]}),e.jsx("div",{className:"px-4 py-3 rounded-xl mb-6 text-center",style:{backgroundColor:d?"#22c55e20":"#f59e0b20",maxWidth:"280px"},children:e.jsx("p",{className:"text-sm font-medium",style:{color:d?"#22c55e":"#f59e0b"},children:d?a==="uz"?"Ajoyib xotira! Davom eting.":"Great memory! Keep it up.":a==="uz"?"Mashq qilishda davom eting!":"Keep practicing to improve!"})}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-[280px]",children:[j.length>0&&e.jsxs("button",{onClick:F,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:[e.jsx(re,{size:18}),a==="uz"?`Xatolarni mashq qilish (${j.length})`:`Practice Incorrect (${j.length})`]}),e.jsxs("button",{onClick:J,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)"},children:[e.jsx(ae,{size:18}),a==="uz"?"Qaytadan boshlash":"Start Over"]}),e.jsx("button",{onClick:()=>p(`/unit/${l}/${i}`),className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-hint)"},children:a==="uz"?"Bo'limga qaytish":"Back to Unit"})]})]})}const U=(m+1)/c.length*100;return e.jsxs("div",{className:"h-full flex flex-col px-4 pt-2 pb-6 safe-area-bottom",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--tg-hint)"},children:z?a==="uz"?"Qayta urinish":"Retry Mode":`${m+1} / ${c.length}`}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{style:{color:"#22c55e"},children:["✓ ",x]}),e.jsxs("span",{style:{color:"#ef4444"},children:["✗ ",B]})]})]}),e.jsx("div",{className:"h-1.5 rounded-full overflow-hidden",style:{backgroundColor:"var(--tg-secondary-bg)"},children:e.jsx(g.div,{className:"h-full rounded-full",style:{backgroundColor:"var(--tg-button)"},initial:{width:0},animate:{width:`${U}%`},transition:{duration:.3}})})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsx(Q,{mode:"wait",children:e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"w-full max-w-sm text-center mb-6",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider mb-3 font-medium",style:{color:"var(--tg-section-header)"},children:a==="uz"?"Inglizcha so'zni yozing:":"Type the English word for:"}),e.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"var(--tg-text)"},children:r?.meaning}),r?.meaningRu&&e.jsxs("p",{className:"text-sm mb-2",style:{color:"var(--tg-subtitle)"},children:["(",r.meaningRu,")"]}),e.jsx("p",{className:"text-sm leading-relaxed",style:{color:"var(--tg-hint)"},children:r?.definition}),T&&e.jsx(g.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"mt-3 px-3 py-2 rounded-lg inline-block",style:{backgroundColor:"#f59e0b20"},children:e.jsx("p",{className:"text-sm font-mono font-bold tracking-widest",style:{color:"#f59e0b"},children:O()})})]},m)}),e.jsxs("div",{className:"w-full max-w-sm",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{ref:$,type:"text",value:b,onChange:t=>k(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(o?H():D())},disabled:o!==null,placeholder:a==="uz"?"So'zni yozing...":"Type the word...",className:"w-full px-4 py-3.5 rounded-xl text-center text-lg font-medium outline-none",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)",border:`2px solid ${o==="correct"?"#22c55e":o==="wrong"||o==="revealed"?"#ef4444":"transparent"}`},autoComplete:"off",autoCapitalize:"off",spellCheck:!1})}),e.jsx(Q,{children:o&&e.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-3 text-center",children:o==="correct"?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-500",children:[e.jsx(ne,{size:18}),e.jsx("span",{className:"text-sm font-semibold",children:a==="uz"?"To'g'ri!":"Correct!"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-red-500 mb-1",children:[e.jsx(le,{size:18}),e.jsx("span",{className:"text-sm font-semibold",children:o==="revealed"?a==="uz"?"Javob ko'rsatildi":"Answer revealed":a==="uz"?"Noto'g'ri":"Incorrect"})]}),e.jsxs("p",{className:"text-sm font-bold",style:{color:"var(--tg-text)"},children:[a==="uz"?"To'g'ri javob: ":"Correct answer: ",e.jsx("span",{className:"text-green-500",children:r?.word})]})]})})})]})]}),e.jsx("div",{className:"flex gap-3 mt-4",children:o===null?e.jsxs(e.Fragment,{children:[T?e.jsx("button",{onClick:X,className:"flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-semibold active:scale-[0.98] transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-subtitle)"},children:e.jsx(ie,{size:16})}):e.jsx("button",{onClick:()=>S(!0),className:"flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-semibold active:scale-[0.98] transition-transform",style:{backgroundColor:"#f59e0b20",color:"#f59e0b"},children:e.jsx(me,{size:16})}),e.jsx("button",{onClick:D,disabled:!b.trim(),className:"flex-1 py-3 rounded-xl text-sm font-semibold active:scale-[0.98] transition-transform disabled:opacity-40",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:a==="uz"?"Tekshirish":"Check"})]}):e.jsx("button",{onClick:H,className:"w-full py-3.5 rounded-xl text-sm font-semibold active:scale-[0.98] transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:m<c.length-1?a==="uz"?"Keyingi so'z →":"Next Word →":a==="uz"?"Natijalarni ko'rish":"See Results"})})]})};export{be as RecallPage};
