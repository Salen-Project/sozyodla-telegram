import{u as O,b as z,r as o,e as D,j as e,g as J,R as P,V as T,c as f}from"./index-CQHhsNEH.js";import{g as U}from"./images-Cz2n-uX2.js";import{C as k}from"./circle-check-big-BiW2bmOm.js";import{C as I}from"./circle-x-Do463jNx.js";import{A as _}from"./arrow-left-DPBaXBRp.js";function q(){const h=O(),{progress:p,saveResult:B,addWordsLearned:A}=z(),[c,b]=o.useState(0),[g,v]=o.useState(!1),[n,$]=o.useState([]),[W,w]=o.useState(!1),[l,j]=o.useState({correct:0,incorrect:0}),N=o.useMemo(()=>{const t=[],m=Date.now(),i=JSON.parse(localStorage.getItem("sozyola_review")||"{}");return Object.entries(p.results).forEach(([x,S])=>{const[a,u]=x.split("-").map(Number),C=D.find(r=>r.id===a)?.units.find(r=>r.id===u);C&&C.words.forEach(r=>{const L=`${a}-${u}-${r.word}`,d=i[L]||{level:0,lastReviewed:0},M=[0,1,3,7,14,30],R=d.lastReviewed+(M[d.level]||30)*24*60*60*1e3;(m>=R||d.level===0)&&t.push({word:r.word,meaning:r.meaning,definition:r.definition,example:r.example,image:r.image,editionId:a,unitId:u,lastReviewed:d.lastReviewed,nextReview:R,level:d.level})})}),t.sort(()=>Math.random()-.5).slice(0,20)},[p.results]);o.useEffect(()=>{$(N)},[N]);const s=n[c],y=t=>{f.impact("light");const m=`${s.editionId}-${s.unitId}-${s.word}`,i=JSON.parse(localStorage.getItem("sozyola_review")||"{}"),x=i[m]?.level||0,S=t?Math.min(x+1,5):Math.max(x-1,0);i[m]={level:S,lastReviewed:Date.now()},localStorage.setItem("sozyola_review",JSON.stringify(i)),j(a=>({correct:a.correct+(t?1:0),incorrect:a.incorrect+(t?0:1)})),t&&A(1),c<n.length-1?(b(c+1),v(!1)):(w(!0),f.notification("success"))},E=()=>{if("speechSynthesis"in window&&s){f.impact("light");const t=new SpeechSynthesisUtterance(s.word);t.lang="en-US",t.rate=.9,speechSynthesis.speak(t)}};if(n.length===0)return e.jsxs("div",{className:"min-h-screen bg-[var(--tg-theme-bg-color)] flex flex-col items-center justify-center p-6 text-center",children:[e.jsx(J,{className:"w-16 h-16 text-green-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-[var(--tg-theme-text-color)] mb-2",children:"All caught up! ðŸŽ‰"}),e.jsx("p",{className:"text-[var(--tg-theme-hint-color)] mb-6",children:"No words need review right now. Study some new words first!"}),e.jsx("button",{onClick:()=>h("/"),className:"px-6 py-3 rounded-xl bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)] font-medium",children:"Go Study"})]});if(W){const t=Math.round(l.correct/(l.correct+l.incorrect)*100);return e.jsxs("div",{className:"min-h-screen bg-[var(--tg-theme-bg-color)] flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:t>=80?"ðŸ†":t>=60?"â­":"ðŸ’ª"}),e.jsx("h1",{className:"text-2xl font-bold text-[var(--tg-theme-text-color)] mb-2",children:"Review Complete!"}),e.jsxs("p",{className:"text-[var(--tg-theme-hint-color)] mb-6",children:["You reviewed ",l.correct+l.incorrect," words"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full max-w-xs mb-6",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-green-500/20 border border-green-500/30",children:[e.jsx(k,{className:"w-6 h-6 text-green-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-[var(--tg-theme-text-color)]",children:l.correct}),e.jsx("p",{className:"text-xs text-[var(--tg-theme-hint-color)]",children:"Correct"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-red-500/20 border border-red-500/30",children:[e.jsx(I,{className:"w-6 h-6 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-[var(--tg-theme-text-color)]",children:l.incorrect}),e.jsx("p",{className:"text-xs text-[var(--tg-theme-hint-color)]",children:"To Review"})]})]}),e.jsxs("div",{className:"flex gap-3 w-full max-w-xs",children:[e.jsx("button",{onClick:()=>h("/"),className:"flex-1 px-4 py-3 rounded-xl bg-[var(--tg-theme-secondary-bg-color)] text-[var(--tg-theme-text-color)] font-medium",children:"Home"}),e.jsx("button",{onClick:()=>{b(0),v(!1),w(!1),j({correct:0,incorrect:0})},className:"flex-1 px-4 py-3 rounded-xl bg-[var(--tg-theme-button-color)] text-[var(--tg-theme-button-text-color)] font-medium",children:"Review Again"})]})]})}return e.jsxs("div",{className:"min-h-screen bg-[var(--tg-theme-bg-color)] flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-[var(--tg-theme-hint-color)]/20",children:[e.jsx("button",{onClick:()=>h(-1),className:"p-2 -ml-2 rounded-full hover:bg-[var(--tg-theme-secondary-bg-color)]",children:e.jsx(_,{className:"w-5 h-5 text-[var(--tg-theme-text-color)]"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{className:"font-semibold text-[var(--tg-theme-text-color)]",children:"Review"})]}),e.jsxs("div",{className:"text-sm text-[var(--tg-theme-hint-color)]",children:[c+1,"/",n.length]})]}),e.jsx("div",{className:"h-1 bg-[var(--tg-theme-secondary-bg-color)]",children:e.jsx("div",{className:"h-full bg-purple-500 transition-all",style:{width:`${(c+1)/n.length*100}%`}})}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-4",children:[[0,1,2,3,4].map(t=>e.jsx("div",{className:`w-2 h-2 rounded-full ${t<(s?.level||0)?"bg-purple-500":"bg-[var(--tg-theme-secondary-bg-color)]"}`},t)),e.jsxs("span",{className:"text-xs text-[var(--tg-theme-hint-color)] ml-2",children:["Level ",s?.level||0]})]}),e.jsxs("div",{onClick:()=>!g&&v(!0),className:"w-full max-w-sm p-6 rounded-2xl bg-[var(--tg-theme-secondary-bg-color)] text-center cursor-pointer",children:[s?.image&&e.jsx("img",{src:U(s.image)||"",alt:s.word,className:"w-32 h-32 object-cover rounded-xl mx-auto mb-4"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("h2",{className:"text-3xl font-bold text-[var(--tg-theme-text-color)]",children:s?.word}),e.jsx("button",{onClick:t=>{t.stopPropagation(),E()},className:"p-2 rounded-full hover:bg-[var(--tg-theme-bg-color)]",children:e.jsx(T,{className:"w-5 h-5 text-[var(--tg-theme-hint-color)]"})})]}),g?e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("p",{className:"text-lg text-[var(--tg-theme-button-color)] font-medium",children:s?.meaning}),e.jsx("p",{className:"text-sm text-[var(--tg-theme-hint-color)]",children:s?.definition}),e.jsxs("p",{className:"text-sm italic text-[var(--tg-theme-hint-color)]",children:['"',s?.example,'"']})]}):e.jsx("p",{className:"text-sm text-[var(--tg-theme-hint-color)] mt-4",children:"Tap to reveal meaning"})]})]}),g&&e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>y(!1),className:"flex-1 py-4 rounded-xl bg-red-500/20 border border-red-500/30 text-red-500 font-semibold flex items-center justify-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Again"]}),e.jsxs("button",{onClick:()=>y(!0),className:"flex-1 py-4 rounded-xl bg-green-500/20 border border-green-500/30 text-green-500 font-semibold flex items-center justify-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Got it!"]})]})]})]})}export{q as default};
