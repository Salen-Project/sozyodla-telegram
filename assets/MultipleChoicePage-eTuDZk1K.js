import{u as Z,a as ee,b as te,r as s,e as se,s as ae,h as le,c as N,j as e,m as C,R as ne}from"./index-Dbv-jb_x.js";import{g as oe}from"./images-Cz2n-uX2.js";import{L as re}from"./list-checks-D7AaBoxy.js";import{R as ce}from"./rotate-ccw-1scVMjdq.js";function $(p){const r=[...p];for(let i=r.length-1;i>0;i--){const v=Math.floor(Math.random()*(i+1));[r[i],r[v]]=[r[v],r[i]]}return r}const ie="sozyola_tg_lang",ge=()=>{const p=Z(),{bookId:r,unitId:i}=ee(),{saveResult:v,addWordsLearned:M,setLastStudied:E,updateStreak:W}=te(),[l]=s.useState(()=>localStorage.getItem(ie)||"uz"),u=se.find(t=>t.id===Number(r)),m=u?.units.find(t=>t.id===Number(i)),x=m?.words||[],w=s.useCallback(t=>l==="ru"&&t.meaningRu?t.meaningRu:t.meaning,[l]),[de,P]=s.useState([]),[o,G]=s.useState([]),[c,q]=s.useState(0),[h,S]=s.useState(null),[T,z]=s.useState(null),[f,Q]=s.useState(0),[L,O]=s.useState(0),[y,B]=s.useState([]),[_,U]=s.useState(!1),[k,A]=s.useState(!1),[D,I]=s.useState(!1),b=s.useCallback(t=>{const n=$(t);P(n);const a=n.map(d=>{const j=x.filter(R=>R.word!==d.word),V=$(j).slice(0,3).map(R=>w(R)),K=$([...V,w(d)]);return{word:d,options:K,correctIndex:K.indexOf(w(d)),imageUrl:oe(d.image)}});G(a),q(0),S(null),z(null),Q(0),O(0),B([]),U(!1),I(!1)},[x,w]);s.useEffect(()=>{x.length>0&&b(x)},[x,b]),s.useEffect(()=>{ae(()=>p(`/unit/${r}/${i}`)),le(),u&&m&&(E(u.id,m.id),W())},[p,r,i,u,m,E,W]),s.useEffect(()=>{I(!1)},[c]);const X=s.useCallback(t=>{if(h!==null)return;S(t);const n=t===o[c].correctIndex;z(n),n?(N.notification("success"),Q(a=>a+1)):(N.notification("error"),O(a=>a+1),B(a=>[...a,o[c].word]))},[h,c,o]),Y=s.useCallback(()=>{if(c<o.length-1)q(t=>t+1),S(null),z(null);else{if(u&&m&&!k){const t=Math.round(f/o.length*100);v(u.id,m.id,{score:f,total:o.length,percentage:t,date:new Date().toISOString()}),M(f)}U(!0),N.notification(f>=o.length*.8?"success":"warning")}},[c,o.length,f,u,m,k,v,M]),F=s.useCallback(()=>{A(!0),b(y),N.impact("medium")},[y,b]),H=s.useCallback(()=>{A(!1),b(x),N.impact("medium")},[x,b]);if(!u||!m||x.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{style:{color:"var(--tg-hint)"},children:"Loading..."})});if(_){const t=o.length,n=t>0?Math.round(f/t*100):0,a=n>=80;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center px-6 pb-6 safe-area-bottom",children:[e.jsx(C.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},className:"w-20 h-20 rounded-full flex items-center justify-center mb-4",style:{background:a?"linear-gradient(135deg, #22c55e, #10b981)":"linear-gradient(135deg, #f59e0b, #f97316)",boxShadow:a?"0 0 30px rgba(34, 197, 94, 0.4)":"0 0 30px rgba(245, 158, 11, 0.4)"},children:e.jsx(re,{size:36,color:"white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--tg-text)"},children:k?l==="uz"?"Qayta urinish tugadi!":"Retry Complete!":l==="uz"?"Test tugadi!":"Quiz Complete!"}),e.jsxs(C.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2},className:"text-5xl font-extrabold mb-4",style:{color:a?"#22c55e":"#f59e0b"},children:[n,"%"]}),e.jsxs("div",{className:"flex gap-8 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#22c55e"},children:f}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:l==="uz"?"To'g'ri":"Correct"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#ef4444"},children:L}),e.jsx("div",{className:"text-xs",style:{color:"var(--tg-hint)"},children:l==="uz"?"Noto'g'ri":"Incorrect"})]})]}),e.jsx("div",{className:"px-4 py-3 rounded-xl mb-6 text-center",style:{backgroundColor:a?"#22c55e20":"#f59e0b20",maxWidth:"280px"},children:e.jsx("p",{className:"text-sm font-medium",style:{color:a?"#22c55e":"#f59e0b"},children:a?l==="uz"?"Ajoyib natija! Davom eting.":"Excellent! Keep it up.":l==="uz"?"Mashq qilishda davom eting!":"Keep practicing to improve!"})}),e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-[280px]",children:[y.length>0&&e.jsxs("button",{onClick:F,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:[e.jsx(ce,{size:18}),l==="uz"?`Xatolarni mashq qilish (${y.length})`:`Practice Incorrect (${y.length})`]}),e.jsxs("button",{onClick:H,className:"w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-text)"},children:[e.jsx(ne,{size:18}),l==="uz"?"Qaytadan boshlash":"Start Over"]}),e.jsx("button",{onClick:()=>p(`/unit/${r}/${i}`),className:"w-full py-3 rounded-xl text-sm font-semibold active:scale-95 transition-transform",style:{backgroundColor:"var(--tg-secondary-bg)",color:"var(--tg-hint)"},children:l==="uz"?"Bo'limga qaytish":"Back to Unit"})]})]})}if(o.length===0)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{style:{color:"var(--tg-hint)"},children:"Loading..."})});const g=o[c],J=(c+1)/o.length*100;return e.jsxs("div",{className:"h-full flex flex-col px-4 pt-2 pb-6 safe-area-bottom",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--tg-hint)"},children:k?l==="uz"?"Qayta urinish":"Retry Mode":`${c+1} / ${o.length}`}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{style:{color:"#22c55e"},children:["✓ ",f]}),e.jsxs("span",{style:{color:"#ef4444"},children:["✗ ",L]})]})]}),e.jsx("div",{className:"h-1.5 rounded-full overflow-hidden",style:{backgroundColor:"var(--tg-secondary-bg)"},children:e.jsx(C.div,{className:"h-full rounded-full",style:{backgroundColor:"var(--tg-button)"},animate:{width:`${J}%`},transition:{duration:.3}})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[g.imageUrl&&!D&&e.jsx("div",{className:"w-full h-32 rounded-xl overflow-hidden mb-3",style:{backgroundColor:"var(--tg-secondary-bg)"},children:e.jsx("img",{src:g.imageUrl,alt:g.word.word,className:"w-full h-full object-cover",onError:()=>I(!0)})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider mb-2 font-medium",style:{color:"var(--tg-section-header)"},children:l==="uz"?"To'g'ri ma'noni tanlang":"Choose the correct meaning"}),e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--tg-text)"},children:g.word.word}),g.word.partOfSpeech&&e.jsxs("span",{className:"text-xs mt-1 inline-block",style:{color:"var(--tg-hint)"},children:["(",g.word.partOfSpeech,")"]})]}),e.jsx("div",{className:"space-y-2 flex-1",children:g.options.map((t,n)=>{const a=h===n,d=h!==null&&n===g.correctIndex,j=a&&!T;return e.jsxs(C.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:n*.05},onClick:()=>X(n),disabled:h!==null,className:"w-full text-left p-3.5 rounded-xl text-sm transition-all active:scale-[0.98]",style:{backgroundColor:d?"#22c55e15":j?"#ef444415":a?"var(--tg-button)":"var(--tg-section-bg)",color:d?"#22c55e":j?"#ef4444":a?"var(--tg-button-text)":"var(--tg-text)",border:`2px solid ${d?"#22c55e":j?"#ef4444":a?"var(--tg-button)":"var(--tg-secondary-bg)"}`},children:[e.jsxs("span",{className:"font-medium",children:[String.fromCharCode(65+n),"."]})," ",t]},`${c}-${n}`)})}),h!==null&&e.jsx(C.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},onClick:Y,className:"w-full py-3.5 rounded-xl text-sm font-semibold mt-4 active:scale-[0.98] transition-transform",style:{backgroundColor:"var(--tg-button)",color:"var(--tg-button-text)"},children:c<o.length-1?l==="uz"?"Keyingi savol →":"Next Question →":l==="uz"?"Natijalarni ko'rish":"See Results"})]})]})};export{ge as MultipleChoicePage};
